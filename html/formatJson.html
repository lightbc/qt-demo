<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			* {
				margin: 0;
				padding: 0;
			}

			body,
			html {
				margin: 10px;
			}

			#container {
				display: flex;
				justify-content: center;
				align-items: center;
				height: 550px;
			}

			.textarea-container {
				float: left;
				width: 40%;
				height: 100%;
				border: 2px solid lightgray;
				overflow: auto;
			}
			::-webkit-scrollbar{
				width: 5px;
			}
			
			::-webkit-scrollbar-thumb{
				background-color: lightgray;
			}
			
			#left {
				margin-right: 4%;
			}

			#right {
				margin-left: 4%;
			}

			#textarea {
				width: 100%;
				height: 100%;
				border: none;
				outline: none;
				resize: none;
				overflow: hidden;
			}

			.key {
				color: #92278F;
			}

			.value {
				color: #3AB54A;
			}

			.line {
				margin: 7px 0;
			}
		</style>
	</head>
	<body>
		<div id="container">
			<div id="left" class="textarea-container">
				<textarea id="textarea"></textarea>
			</div>
			<div id="right" class="textarea-container">
				<pre id="showFormat"></pre>
			</div>
		</div>
	</body>
</html>
<script>
	window.onload = function() {
		var ele = document.getElementById("textarea");

		keyUpListener(ele);
	}

	/**
	 * 键盘按钮释放监听
	 * @param {Object} ele
	 */
	function keyUpListener(ele) {
		ele.addEventListener('keyup', function(e) {
			var val = ele.value;
			parse(val);
		});
	}

	/**
	 * 解析对象
	 * @param {Object} val
	 */
	function parse(val) {
		var showFormat = document.getElementById("showFormat");
		if (undefined == val || null == val || "" == val.trim()) {
			showFormat.innerHTML = "";
			return;
		}
		if (isJson(val)) {
			var pj = parseJson(val);
			showFormat.innerHTML = pj;
		} else {
			showFormat.innerHTML = "Content is not JSON.";
		}
	}


	/**
	 * 解析json数据
	 * @param {Object} json
	 */
	function parseJson(json) {
		var reg = null,
			formatted = '',
			pad = 0,
			// 缩进量
			PADDING = '  ';
		if (typeof json !== 'string') {
			// 确保为JSON字符串
			json = JSON.stringify(json);
		} else {
			//已经是一个字符串，所以解析和重新字符串化以删除额外的空白
			json = JSON.parse(json);
			json = JSON.stringify(json);
		}
		// 在花括号前后添加换行
		reg = /([\{\}])/g;
		json = json.replace(reg, '\r\n$1\r\n');
		// value为json对象时，开始的花括号不换行显示
		reg = /(:\r\n\{)/g;
		json = json.replace(reg, ':{');
		// 在方括号前后添加新行
		reg = /([\[\]])/g;
		json = json.replace(reg, '\r\n$1\r\n');
		// value为json数组时，开始的方括号不换行显示
		reg = /(:\r\n\[)/g;
		json = json.replace(reg, ':[');
		// 在逗号后添加新行
		reg = /(\,)/g;
		json = json.replace(reg, '$1\r\n');
		// 删除多个换行
		reg = /(\r\n\r\n)/g;
		json = json.replace(reg, '\r\n');
		// 删除逗号前的换行
		reg = /\r\n\,/g;
		json = json.replace(reg, ',');

		var jsons = json.trim().split('\r\n');
		if (jsons != null) {
			for (var j = 0; j < jsons.length; j++) {
				var node = jsons[j];
				var i = 0,
					indent = 0,
					padding = '';
				if (node.match(/\{$/) || node.match(/\[$/)) {
					indent = 1;
				} else if (node.match(/\}/) || node.match(/\]/)) {
					if (pad !== 0) {
						pad -= 1;
					}
				} else {
					indent = 0;
				}
				for (i = 0; i < pad; i++) {
					padding += PADDING;
				}
				node = node.replace(/("[\s\S]*"):/, '<span class="key">$1</span>:')
				node = node.replace(/:("[\s\S]*")/, ':<span class="value">$1</span>');
				node = '<div class="line">'+padding + node + '\r\n'+'</div>';
				formatted += node;
				pad += indent;
			}
		}
		return formatted;
	};

	/**
	 * 判断是否使json格式数据，true-使，false-否
	 * @param {Object} val 
	 */
	function isJson(val) {
		let b = false;
		try {
			JSON.parse(val);
			b = true;
		} catch (ex) {} finally {
			return b;
		}
	}
</script>
